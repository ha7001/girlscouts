{% extends 'base.twig' %}

{% block title %} motorTitle {% endblock %}
{% block css %}
    <style type="text/css">
        img.img-responsive {
            margin: 0 auto;
        }

        .step h3.popover-title {
            margin-bottom: 0;
        }
    </style>
{% endblock %}
{% block content %}
    <!--
    <div class="container">
        <div class="row">
            <div class="col-md-12 main-title">
                <h1>{{ motorTitle }}</h1>
            </div>
        </div>
    </div>
    -->
    <section class="container" id="main">

        <!-- Start Survey container -->
        <div id="survey_container">
            <!--
            <div id="top-wizard">
                <strong>Progress <span id="location"></span></strong>
                <div id="progressbar"></div>
                <div class="shadow"></div>
            </div><!-- end top-wizard -->

            <form name="reyComplexFigure1" id="wrapped" action="" method="POST">
                <div id="middle-wizard">
                    <!-- Motor Task one instructions -->
                    <div class="step row">
                        <div class="col-md-12">
                            <h4>
                                {{ motorInstructions1 | raw }}
                            </h4>
                        </div>
                    </div>
                    <!-- Motor Task one Dominant -->
                    <div class="step row">
                        <div class="row">
                            <div class="col-xs-10">
                                <h4>{{ motorInstructionsDominant | raw}}</h4>
                            </div>
                            <div class="col-xs-2">
                                <!-- TODO Timer Code -->
                                <h4>
                                    <span id="counter">15</span> second(s).
                                </h4>
                            </div>
                        </div>
                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant1a' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <!-- Button to start the motor task -->
                            <button id="MotorTask1a" type="button" class="btn center-block">Start Test</button>
                            <!--setInterval(countdown(), 10) -->
                        </div>
                    </div>
                    <!-- Motor Task one Non-Dominant -->
                    <div class="step row">
                        <h4>{{ motorInstructionsNonDominant | raw}}</h4>
                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant1b' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask1b" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>

                    <!-- Motor Task two instructions -->
                    <div class="step row">
                        <div class="col-md-12">
                            <p>
                                {{ motorInstructions2 | raw }}
                            </p>
                        </div>
                    </div>
                    <!-- Motor Task two Dominant -->
                    <div class="step row">
                        <h4>{{ motorInstructionsDominant | raw}}</h4>
                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant2a' class="center-block" width="611" height="542" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask2a" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>
                    <!-- Motor Task two Non-Dominant -->
                    <div class="step row">
                        <h4>{{ motorInstructionsNonDominant | raw}}</h4>
                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant2b' class="center-block" width="611" height="542" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask2b" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>

                    <!-- Motor Task three instructions -->
                    <div class="step row">
                        <div class="col-md-12">
                            <p>
                                {{ motorInstructions3 | raw }}
                            </p>
                        </div>
                    </div>
                    <!-- Motor Task three Dominant -->
                    <div class="step row">
                        <h4>{{ motorInstructionsDominant | raw}}</h4>
                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant3a' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask3a" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>
                    <!-- Motor Task three Non-Dominant -->
                    <div class="step row">
                        <h4>{{ motorInstructionsNonDominant }}</h4>
                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant3b' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask3b" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>


                    <div class="submit step" id="complete">
                        <i class="icon-check"></i>
                        <h3>Test complete!</h3>
                        <button type="submit" name="process" class="submit">Submit</button>
                    </div><!-- end submit step -->
                    </div>

                    <div id="bottom-wizard">
                        <button id="backwardButton" type="button" name="backward" class="backward">Backward</button>
                        <button id="forwardButton" type="button" name="forward" class="forward">Forward</button>
                    </div><!-- end bottom-wizard -->
            </form>
        </div><!-- end Survey container -->
    </section>
{% endblock %}
{% block extra %}{% endblock %}
{% block script %}
    <script type="text/javascript" src="/assets/js/jcanvas.min.js"></script>
    <script type="text/javascript" src="/assets/js/jTimer.js"></script>
    <script>
        var timerId;

        $(document).ready(function () {
            //Setup Drawing Steps
            var $motorTaskOneDominant1a = $("#motorTaskOneDominant1a");
            var $motorTaskOneDominant1b = $("#motorTaskOneDominant1b");
            var $motorTaskOneDominant2a = $("#motorTaskOneDominant2a");
            var $motorTaskOneDominant2b = $("#motorTaskOneDominant2b");
            var $motorTaskOneDominant3a = $("#motorTaskOneDominant3a");
            var $motorTaskOneDominant3b = $("#motorTaskOneDominant3b");
            var pts1a = [];
            var lines1a = [];
            var line_obj1a = {};
            var isDown1a = false;
            $motorTaskOneDominant1a.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                fromCenter: false,
                mousedown: function (layer) {
                    line_obj1a = {
                        strokeStyle: "#000",
                        strokeWidth: 2,
                        data: {
                            joints: 1
                        }
                    };

                    isDown1a = true;
                    pts1a.push([layer.eventX, layer.eventY]);
                },
                mousemove: function (layer) {
                    if (isDown1a) {
                        pts1a.push([layer.eventX, layer.eventY]);
                        for (var p = 0; p < pts1a.length; p += 1) {
                            line_obj1a['x' + (p + 1)] = pts1a[p][0];
                            line_obj1a['y' + (p + 1)] = pts1a[p][1];
                        }
                        $motorTaskOneDominant1a.drawLine(line_obj1a);
                    }
                    for (var i = 0; i < lines1a.length; i++) {
                        $motorTaskOneDominant1a.drawLine(lines1a[i]);
                    }
                },
                mouseup: function (layer) {
                    lines1a.push(line_obj1a);

                    for (var i = 0; i < lines1a.length; i++) {
                        $motorTaskOneDominant1a.drawLine(lines1a[i]);
                    }
                    line_obj1a = {};
                    pts1a = [];
                    isDown1a = false;
                },
                mouseout: function (layer) {
                    console.log(lines1a);

                    for (var i = 0; i < lines1a.length; i++) {
                        $motorTaskOneDominant1a.drawLine(lines1a[i]);
                    }
                }
            });
            var pts1b = [];
            var lines1b = [];
            var line_obj1b = {};
            var isDown1b = false;
            $motorTaskOneDominant1b.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                fromCenter: false,
                mousedown: function (layer) {
                    line_obj1b = {
                        strokeStyle: "#000",
                        strokeWidth: 2,
                        data: {
                            joints: 1
                        }
                    };

                    isDown1b = true;
                    pts1b.push([layer.eventX, layer.eventY]);
                },
                mousemove: function (layer) {
                    if (isDown1b) {
                        pts1b.push([layer.eventX, layer.eventY]);
                        for (var p = 0; p < pts1b.length; p += 1) {
                            line_obj1b['x' + (p + 1)] = pts1b[p][0];
                            line_obj1b['y' + (p + 1)] = pts1b[p][1];
                        }
                        $motorTaskOneDominant1b.drawLine(line_obj1b);
                    }
                    for (var i = 0; i < lines1b.length; i++) {
                        $motorTaskOneDominant1b.drawLine(lines1b[i]);
                    }
                },
                mouseup: function (layer) {
                    lines1b.push(line_obj1b);

                    for (var i = 0; i < lines1b.length; i++) {
                        $motorTaskOneDominant1b.drawLine(lines1b[i]);
                    }
                    line_obj1b = {};
                    pts1b = [];
                    isDown1b = false;
                },
                mouseout: function (layer) {
                    console.log(lines1b);

                    for (var i = 0; i < lines1b.length; i++) {
                        $motorTaskOneDominant1b.drawLine(lines1b[i]);
                    }
                }
            });

            $motorTaskOneDominant2a.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 800, height: 500,
                fromCenter: false,
                mousedown: function (layer) {
                    $('canvas').addLayer({
                        type: 'rectangle',
                        fillStyle: '#585',
                        x: layer.eventX, y: layer.eventY,
                        width: 10, height: 10
                    }).drawLayers();
                },
                mouseup: function (layer) {
                    drawLayers();
                }
            });

            $motorTaskOneDominant2b.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 800, height: 500,
                fromCenter: false,
                mousedown: function (layer) {
                    $('canvas').addLayer({
                        type: 'rectangle',
                        fillStyle: '#585',
                        x: layer.eventX, y: layer.eventY,
                        width: 10, height: 10
                    }).drawLayers();
                },
                mouseup: function (layer) {
                    drawLayers();
                }
            });

            $motorTaskOneDominant3a.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                fromCenter: false,
                mousedown: function (layer) {
                    $('canvas').addLayer({
                        type: 'rectangle',
                        fillStyle: '#585',
                        x: layer.eventX, y: layer.eventY,
                        width: 10, height: 10
                    }).drawLayers();
                },
                mouseup: function (layer) {
                    drawLayers();
                }
            });

            $motorTaskOneDominant3b.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                fromCenter: false,
                mousedown: function (layer) {
                    $('canvas').addLayer({
                        type: 'rectangle',
                        fillStyle: '#585',
                        x: layer.eventX, y: layer.eventY,
                        width: 10, height: 10
                    }).drawLayers();
                },
                mouseup: function (layer) {
                    drawLayers();
                }
            });

            //Draw respective images onto canvases.
            var $select = $('#MotorTask1a');
            $select.click(function() {
                setupMotorTask1a();
                timerId = setInterval(countdown, 1000);
            });

        });




        //Setup the MotorTask 1 and start the timer
        function setupMotorTask1a(){
            var $motorTaskOneDominant1a = $("#motorTaskOneDominant1a");
            $motorTaskOneDominant1a.drawImage({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                index: 0,
                source: "/assets/img/motorTasks/Trazado.png",
                fromCenter: false
            }).drawLayers();
        }
        function setupMotorTask1b(){
            var $motorTaskOneDominant1b = $("#motorTaskOneDominant1b");
            $motorTaskOneDominant1b.drawImage({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                index: 0,
                source: "/assets/img/motorTasks/Trazado.png",
                fromCenter: false
            }).drawLayers();
        }
        function setupMotorTask2a(){
            var $motorTaskOneDominant2a = $("#motorTaskOneDominant2a");
            $motorTaskOneDominant2a.drawImage({
                layer: true,
                x: 0, y: 0,
                width: 611, height: 542,
                index: 0,
                source: "/assets/img/motorTasks/Marcado.png",
                fromCenter: false
            }).drawLayers();
        }
        function setupMotorTask2b(){
            var $motorTaskOneDominant2b = $("#motorTaskOneDominant2b");
            $motorTaskOneDominant2b.drawImage({
                layer: true,
                x: 0, y: 0,
                width: 611, height: 542,
                index: 0,
                source: "/assets/img/motorTasks/Marcado.png",
                fromCenter: false
            }).drawLayers();
        }
        function setupMotorTask3a(){
            var $motorTaskOneDominant3a = $("#motorTaskOneDominant3a");
            $motorTaskOneDominant3a.drawImage({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                index: 0,
                source: "/assets/img/motorTasks/Punteado.png",
                fromCenter: false
            }).drawLayers();
        }
        function setupMotorTask3b(){
            var $motorTaskOneDominant3b = $("#motorTaskOneDominant3b");
            $motorTaskOneDominant3b.drawImage({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                index: 0,
                source: "/assets/img/motorTasks/Punteado.png",
                fromCenter: false
            }).drawLayers();
        }


    <!--Timer Stuff -->
        function countdown() {
            var $i = $('#counter');
            console.log($i.text());
            $i.text(parseInt($i.text())-1);
            if ($i.text()==0) {
                clearInterval(timerId);
            }
        }

    </script>
{% endblock %}
