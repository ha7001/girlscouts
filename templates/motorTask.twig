{% extends 'base.twig' %}
{% block title %} motorTitle {% endblock %}
{% block css %}
    <style type="text/css">
        #motorTaskOneDominant1a, #motorTaskOneDominant1b, #motorTaskOneDominant2a, #motorTaskOneDominant2b, #motorTaskOneDominant3a, #motorTaskOneDominant3b {
            display: none;
        }
        img.img-responsive {
            margin: 0 auto;
        }

        .step h3.popover-title {
            margin-bottom: 0;
        }
    </style>
{% endblock %}
{% block content %}
    <!-- BIG TODO: The act of forceing the user to the next test seems to interrupt the drawing process. This means the lines the user drawn
     won't get saved and therefore are lost. Unless the user lifts their finger. Need to find a way to store the points immediatly?  -->



    <!--
    <div class="container">
        <div class="row">
            <div class="col-md-12 main-title">
                <h1>{{ motorTitle }}</h1>
            </div>
        </div>
    </div>
    -->
    <section class="container" id="main">

        <!-- Start Survey container -->
        <div id="survey_container">
            <!--
            <div id="top-wizard">
                <strong>Progress <span id="location"></span></strong>
                <div id="progressbar"></div>
                <div class="shadow"></div>
            </div><!-- end top-wizard -->

            <form name="motorTask" id="wrapped" action="" method="POST">
                <div id="middle-wizard">
                    <!-- Motor Task one instructions -->
                    <div class="step row">
                        <div class="col-md-12">
                            <h4>
                                {{ motorInstructions1 | raw }}
                            </h4>
                        </div>
                    </div>
                    <!-- Motor Task one Dominant -->
                    <div class="step row">
                        <div class="row">
                            <div class="col-xs-10">
                                <h4>{{ motorInstructionsDominant | raw }}</h4>
                            </div>
                            <div class="col-xs-2">
                                <h4>
                                    <span class="counter">15</span> second(s).
                                </h4>
                            </div>
                        </div>
                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant1a' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <!-- Button to start the motor task -->
                            <button id="MotorTask1a" type="button" class="btn center-block">Start Test</button>
                            <!--setInterval(countdown(), 10) -->
                        </div>
                    </div>
                    <!-- Motor Task one Non-Dominant -->
                    <div class="step row">
                        <div class="col-xs-10">
                            <h4>{{ motorInstructionsNonDominant | raw }}</h4>
                        </div>
                        <div class="col-xs-2">
                            <h4>
                                <span class="counter">15</span> second(s).
                            </h4>
                        </div>

                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant1b' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask1b" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>

                    <!-- Motor Task two instructions -->
                    <div class="step row">
                        <div class="col-md-12">
                            <p>
                                {{ motorInstructions2 | raw }}
                            </p>
                        </div>
                    </div>
                    <!-- Motor Task two Dominant -->
                    <div class="step row">
                        <div class="col-xs-10">
                            <h4>{{ motorInstructionsDominant | raw }}</h4>
                        </div>
                        <div class="col-xs-2">
                            <h4>
                                <span class="counter">15</span> second(s).
                            </h4>
                        </div>

                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant2a' class="center-block" width="611" height="542" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask2a" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>
                    <!-- Motor Task two Non-Dominant -->
                    <div class="step row">
                        <div class="col-xs-10">
                            <h4>{{ motorInstructionsNonDominant | raw }}</h4>
                        </div>
                        <div class="col-xs-2">
                            <h4>
                                <span class="counter">15</span> second(s).
                            </h4>
                        </div>

                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant2b' class="center-block" width="611" height="542" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask2b" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>


                    <!-- Motor Task three instructions -->
                    <div class="step row">
                        <div class="col-md-12">
                            <p>
                                {{ motorInstructions3 | raw }}
                            </p>
                        </div>
                    </div>
                    <!-- Motor Task three Dominant -->
                    <div class="step row">
                        <div class="col-xs-10">
                            <h4>{{ motorInstructionsDominant | raw }}</h4>
                        </div>
                        <div class="col-xs-2">
                            <h4>
                                <span class="counter">15</span> second(s).
                            </h4>
                        </div>

                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant3a' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask3a" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>
                    <!-- Motor Task three Non-Dominant -->
                    <div class="step row">
                        <div class="col-xs-10">
                            <h4>{{ motorInstructionsNonDominant | raw }}</h4>
                        </div>
                        <div class="col-xs-2">
                            <h4>
                                <span class="counter">15</span> second(s).
                            </h4>
                        </div>

                        <div id="canvas-drawing">
                            <canvas id='motorTaskOneDominant3b' class="center-block" width="850" height="600" style="border:1px solid #000000;"></canvas>
                            <button id="MotorTask3b" type="button" class="btn center-block">Start Test</button>
                        </div>
                    </div>


                    <div class="submit step" id="complete">
                        <i class="icon-check"></i>
                        <h3>Test complete!</h3>
                        <button type="submit" name="process" class="submit">Submit</button>
                    </div><!-- end submit step -->
                </div>

                <div id="bottom-wizard">
                    <button id="backwardButton" type="button" name="backward" class="backward" >Backward</button>
                    <button id="forwardButton" type="button" name="forward" class="forward">Forward</button>
                </div><!-- end bottom-wizard -->
            </form>
        </div><!-- end Survey container -->
    </section>
{% endblock %}
{% block extra %}{% endblock %}
{% block script %}
    <script type="text/javascript" src="/assets/js/jcanvas.min.js"></script>
    <script type="text/javascript" src="/assets/js/jTimer.js"></script>
    <script>
        var timer;

        function drawRectangle(layer) {
            return {
                type: 'rectangle',
                fillStyle: '#585',
                x: layer.eventX, y: layer.eventY,
                width: 10, height: 10,
                index: 1
            };
        }

        function drawRec(width, height) {
            return {
                layer: true,
                x: 0, y: 0,
                width: width, height: height,
                fromCenter: false,
                mousedown: function (layer) {
                    $(this).addLayer(drawRectangle(layer)).drawLayers();
                }
            };
        }

        function imageObject(imagePath, width, height) {
            return {
                layer: true,
                x: 0, y: 0,
                width: width, height: height,
                index: 0,
                source: imagePath,
                fromCenter: false
            };
        }

        var $motor1a = $('#MotorTask1a');
        var $motor1b = $('#MotorTask1b');
        var $motor2a = $('#MotorTask2a');
        var $motor2b = $('#MotorTask2b');
        var $motor3a = $('#MotorTask3a');
        var $motor3b = $('#MotorTask3b');
        var $counter = $('.counter');
        var $forward = $('#forwardButton');
        var $motorTaskOneDominant1a = $("#motorTaskOneDominant1a");
        var $motorTaskOneDominant1b = $("#motorTaskOneDominant1b");
        var $motorTaskOneDominant2a = $("#motorTaskOneDominant2a");
        var $motorTaskOneDominant2b = $("#motorTaskOneDominant2b");
        var $motorTaskOneDominant3a = $("#motorTaskOneDominant3a");
        var $motorTaskOneDominant3b = $("#motorTaskOneDominant3b");

        $(document).ready(function () {
            var ptsPractice = [];
            var line_objPractice = {};
            var isDownPractice = false;
            var practice_name = 0;

            var drawingObject = {
                mousedown: function (layer) {
                    practice_name++;

                    line_objPractice = {
                        layer: true,
                        type: 'line',
                        name: "practice" + practice_name,
                        strokeStyle: "#000",
                        strokeWidth: 2
                    };

                    isDownPractice = true;
                    ptsPractice.push([layer.eventX, layer.eventY]);

                    $(this).addLayer(line_objPractice).drawLayers();
                    $(this).moveLayer("practice" + practice_name, 1);
                },
                mousemove: function (layer) {
                    if (isDownPractice) {
                        ptsPractice.push([layer.eventX, layer.eventY]);
                        for (var p = 0; p < ptsPractice.length; p += 1) {
                            line_objPractice['x' + (p + 1)] = ptsPractice[p][0];
                            line_objPractice['y' + (p + 1)] = ptsPractice[p][1];
                        }
                        $(this).drawLine(line_objPractice);
                    }
                },
                mouseup: function (layer) {
                    $(this).setLayer("practice" + practice_name, line_objPractice).drawLayers();

                    line_objPractice = {};
                    ptsPractice = [];
                    isDownPractice = false;
                },
                mouseout: function (layer) {
                    $(this).setLayer("practice" + practice_name, line_objPractice).drawLayers();
                }
            };

            //Setup Drawing Steps
            $motorTaskOneDominant1a.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                fromCenter: false,
                name: "mtd1a"
            }).setLayer("mtd1a", drawingObject);

            $motorTaskOneDominant1b.drawRect({
                layer: true,
                x: 0, y: 0,
                width: 850, height: 600,
                fromCenter: false,
                name: "mtd1b"
            }).setLayer("mtd1b", drawingObject);

            $motorTaskOneDominant2a.drawRect(drawRec(800, 600));
            $motorTaskOneDominant2b.drawRect(drawRec(800, 500));
            $motorTaskOneDominant3a.drawRect(drawRec(850, 600));
            $motorTaskOneDominant3b.drawRect(drawRec(850, 600));

            //Draw respective images onto canvases.
            $motor1a.click(function () {
                setupMotorTask($motorTaskOneDominant1a, $(this), imageObject("/assets/img/motorTasks/Trazado.png", 850, 600));
            });
            $motor1b.click(function () {
                setupMotorTask($motorTaskOneDominant1b, $(this), imageObject("/assets/img/motorTasks/Trazado.png", 850, 600));
            });
            $motor2a.click(function () {
                setupMotorTask($motorTaskOneDominant2a, $(this), imageObject("/assets/img/motorTasks/Marcado.png", 611, 542));
            });
            $motor2b.click(function () {
                setupMotorTask($motorTaskOneDominant2b, $(this), imageObject("/assets/img/motorTasks/Marcado.png", 611, 542));
            });
            $motor3a.click(function () {
                setupMotorTask($motorTaskOneDominant3a, $(this), imageObject("/assets/img/motorTasks/Punteado.png", 850, 600));
            });
            $motor3b.click(function () {
                setupMotorTask($motorTaskOneDominant3b, $(this), imageObject("/assets/img/motorTasks/Punteado.png", 850, 600));
            });
        });


        //Setup the MotorTask 1 and start the timer
        function setupMotorTask($canvas, $btn, $image) {
            $canvas.drawImage($image).drawLayers();
            $canvas.show();
            $counter.text(15);
            timer = setInterval(countdown, 1000);
            $btn.hide();
        }

        <!--Timer Stuff -->
        function countdown() {
            $counter.text(parseInt($counter.first().text()) - 1);
            if ($counter.text() == 0) {
                clearInterval(timer);
                $forward.trigger('click');
            }
        }
    </script>
{% endblock %}
