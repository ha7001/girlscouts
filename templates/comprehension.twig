{% extends 'base.twig' %}

{% block title %}Comprehension Test{% endblock %}
{% block css %}
    <style type="text/css">
        img.img-responsive {
            margin: 0 auto;
        }

        .step h3.popover-title {
            margin-bottom: 0;
        }
    </style>
{% endblock %}
{% block content %}
    <!--
    <div class="container">
        <div class="row">
            <div class="col-md-12 main-title">
                <h1>{{ ComprehensionTitle }}</h1>
            </div>
        </div>
    </div>
    -->

    <section class="container" id="main">

        <!-- Start Survey container -->
        <div id="survey_container">
            <form name="comprehensionTest" id="wrapped">
                <!-- Eye Test start -->
                <div id="middle-wizard">
                    <!--Dummy span used to hold the audio output -->
                    <audio id="audio" src=""></audio>
                    <div class="step row" style="text-align: center">
                        <h4>
                            {{ ComprehensionInstructions | raw }}
                        </h4>
                    </div>

                    <!-- Comprehension question through javascript example -->
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension1" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension1"/>
                            <br>
                            <button id="comprehension1Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension2" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension2"/>
                            <br>
                            <button id="comprehension2Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension3" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension3"/>
                            <br>
                            <button id="comprehension3Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension4" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension4"/>
                            <br>
                            <button id="comprehension4Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension5" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension5"/>
                            <br>
                            <button id="comprehension5Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension6" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension6"/>
                            <br>
                            <button id="comprehension6Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension7" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension7"/>
                            <br>
                            <button id="comprehension7Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension8" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension8"/>
                            <br>
                            <button id="comprehension8Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension9" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension9"/>
                            <br>
                            <button id="comprehension9Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension10" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension10"/>
                            <br>
                            <button id="comprehension10Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension11" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension11"/>
                            <br>
                            <button id="comprehension11Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension12" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension12"/>
                            <br>
                            <button id="comprehension12Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension13" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension13"/>
                            <br>
                            <button id="comprehension13Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension14" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension14"/>
                            <br>
                            <button id="comprehension14Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension15" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension15"/>
                            <br>
                            <button id="comprehension15Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension16" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension16"/>
                            <br>
                            <button id="comprehension16Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension17" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension17"/>
                            <br>
                            <button id="comprehension17Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension18" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension18"/>
                            <br>
                            <button id="comprehension18Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension19" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension19"/>
                            <br>
                            <button id="comprehension19Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension20" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension20"/>
                            <br>
                            <button id="comprehension20Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>
                    <div class="step row">
                        <div class="col-xs-12" style="text-align: center">
                            <canvas id="comprehension21" width="700" height="560" style="border:1px solid #000000;"></canvas>
                            <input type="hidden" name="comprehension21"/>
                            <br>
                            <button id="comprehension21Button" type="button" class="btn center-block"><b>Click here for the Question</b></button>
                            <br>
                        </div>
                    </div>

                    <div class="submit step" id="complete">
                        <i class="icon-check"></i>
                        <h3>Very Nice!</h3>
                        <button type="submit" name="process" class="submit">Complete!</button>
                    </div><!-- end submit step -->
                </div>

                <div id="bottom-wizard">
                    <!--<button id="backwardButton" type="button" name="backward" class="backward" >Backward</button>-->
                    <button id="forwardButton" type="button" name="forward" class="forward" disabled>Forward</button>
                </div><!-- end bottom-wizard -->
            </form>
        </div><!-- end Survey container -->
    </section>
{% endblock %}
{% block extra %}{% endblock %}
{% block script %}
    <script type="text/javascript" src="/assets/js/jcanvas.min.js"></script>
    <script type="text/javascript">
        //Each type of test has the ans choices in different places so a different method for each type of test: a,b,c,d,e

        //Choice placement for Images in the A catetory, these are preset since they don't change in the first set of images.
        var startingXA = 0;
        var startingYA = 0;
        var xSpacingA = 140;
        var ySpacingA = 140;
        var widthA = 140;
        var heightA = 140;
        var rowA = 4;
        var columnA = 5;

        function setBoardComprehensionSingle($canvas, input, imagePath) {
            $canvas.drawImage({
                layer: true,
                x: 0, y: 0,
                index: 0,
                source: imagePath,
                width: 700, height: 560
            }).drawLayers();


            var count = 1;

            for (var y = 0; y < rowA; y++) {
                for (var x = 0; x < columnA; x++) {
                    $canvas.addLayer({
                        type: 'rectangle',
                        groups: ['questions'],
                        name: 'step' + count++,
                        strokeStyle: 'red',
                        strokeWidth: 0,
                        x: startingXA + (xSpacingA * x), y: startingYA + (ySpacingA * y),
                        width: widthA,
                        height: heightA,
                        click: function (layer) {
                            console.log(input);
                            $('input[name="' + input + '"]').val(layer.name.replace('step', ''));
                            $('#forwardButton').prop('disabled', false);

                            $canvas.setLayerGroup('questions', {
                                strokeWidth: 0
                            }).drawLayers();

                            $canvas.setLayer(layer.name, {
                                strokeWidth: 4
                            }).drawLayers();
                        }
                    }).drawLayers();
                }
            }
        }

        function setBoardComprehensionMulitple($canvas, input, imagePath) {
            var answers = [];

            $canvas.drawImage({
                layer: true,
                x: 0, y: 0,
                index: 0,
                source: imagePath,
                width: 700, height: 560
            }).drawLayers();


            var count = 1;

            for (var y = 0; y < rowA; y++) {
                for (var x = 0; x < columnA; x++) {
                    $canvas.addLayer({
                        type: 'rectangle',
                        groups: ['questions'],
                        name: 'step' + count++,
                        strokeStyle: 'red',
                        strokeWidth: 0,
                        x: startingXA + (xSpacingA * x), y: startingYA + (ySpacingA * y),
                        width: widthA,
                        height: heightA,
                        click: function (layer) {
                            if (layer.strokeWidth == 0) {
                                console.log('selected');
                                $canvas.setLayer(layer.name, {
                                    strokeWidth: 4
                                }).drawLayers();
                                answers.push(layer.name.replace('step', ''));
                                $('#forwardButton').click();
                            } else if (layer.strokeWidth == 4) {
                                console.log('unselected');
                                $canvas.setLayer(layer.name, {
                                    strokeWidth: 0
                                }).drawLayers();

                                var index = answers.indexOf(layer.name.replace('step', ''));

                                answers.splice(index, 1);
                            }

                            var answer = '';

                            for (var i = 0;i < answers.length;i++) {
                                answer += answers[i] + ", ";
                            }

                            answer = answer.slice(0, answer.length - 2);

                            $('input[name="' + input + '"]').val(answer);
                            $('#forwardButton').prop('disabled', false);


                        }
                    }).drawLayers();
                }
            }
        }




        $(document).ready(function () {
            //Define canvases
            var $comprehension1 = $('#comprehension1');
            var $comprehension2 = $('#comprehension2');
            var $comprehension3 = $('#comprehension3');
            var $comprehension4 = $('#comprehension4');
            var $comprehension5 = $('#comprehension5');
            var $comprehension6 = $('#comprehension6');
            var $comprehension7 = $('#comprehension7');
            var $comprehension8 = $('#comprehension8');
            var $comprehension9 = $('#comprehension9');
            var $comprehension10 = $('#comprehension10');
            var $comprehension11 = $('#comprehension11');
            var $comprehension12 = $('#comprehension12');
            var $comprehension13 = $('#comprehension13');
            var $comprehension14 = $('#comprehension14');
            var $comprehension15 = $('#comprehension15');
            var $comprehension16 = $('#comprehension16');
            var $comprehension17 = $('#comprehension17');
            var $comprehension18 = $('#comprehension18');
            var $comprehension19 = $('#comprehension19');
            var $comprehension20 = $('#comprehension20');
            var $comprehension21 = $('#comprehension21');


            //Define buttons to play audio
            var $comprehensionStart1 = $('#comprehension1Button');
            var $comprehensionStart2 = $('#comprehension2Button');
            var $comprehensionStart3 = $('#comprehension3Button');
            var $comprehensionStart4 = $('#comprehension4Button');
            var $comprehensionStart5 = $('#comprehension5Button');
            var $comprehensionStart6 = $('#comprehension6Button');
            var $comprehensionStart7 = $('#comprehension7Button');
            var $comprehensionStart8 = $('#comprehension8Button');
            var $comprehensionStart9 = $('#comprehension9Button');
            var $comprehensionStart10 = $('#comprehension10Button');
            var $comprehensionStart11 = $('#comprehension11Button');
            var $comprehensionStart12 = $('#comprehension12Button');
            var $comprehensionStart13 = $('#comprehension13Button');
            var $comprehensionStart14 = $('#comprehension14Button');
            var $comprehensionStart15 = $('#comprehension15Button');
            var $comprehensionStart16 = $('#comprehension16Button');
            var $comprehensionStart17 = $('#comprehension17Button');
            var $comprehensionStart18 = $('#comprehension18Button');
            var $comprehensionStart19 = $('#comprehension19Button');
            var $comprehensionStart20 = $('#comprehension20Button');
            var $comprehensionStart21 = $('#comprehension21Button');

            $.jCanvas.defaults.fromCenter = false;

            //Button click handlers
            $comprehensionStart1.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-01.mp3");
                $('#comprehension1Button').remove();
                $('#forwardButton').prop('disabled', true);
            });
            $comprehensionStart2.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-02.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension2Button').remove();
            });
            $comprehensionStart3.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-03.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension3Button').remove();
            });
            $comprehensionStart4.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-04.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension4Button').remove();
            });
            $comprehensionStart5.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-05.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension5Button').remove();
            });
            $comprehensionStart6.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-06.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension6Button').remove();
            });
            $comprehensionStart7.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-07.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension7Button').remove();
            });
            $comprehensionStart8.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-08.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension8Button').remove();
            });
            $comprehensionStart9.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-09.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension9Button').remove();
            });
            $comprehensionStart10.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-10.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension10Button').remove();
            });
            $comprehensionStart11.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-11.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension11Button').remove();
            });
            $comprehensionStart12.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-12.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension12Button').remove();
            });
            $comprehensionStart13.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-13.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension13Button').remove();
            });
            $comprehensionStart14.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-14.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension14Button').remove();
            });
            $comprehensionStart15.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-15.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension15Button').remove();
            });
            $comprehensionStart16.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-16.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension16Button').remove();
            });
            $comprehensionStart17.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-17.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension17Button').remove();
            });
            $comprehensionStart18.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-18.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension18Button').remove();
            });
            $comprehensionStart19.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-19.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension19Button').remove();
            });
            $comprehensionStart20.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-20.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension20Button').remove();
            });
            $comprehensionStart21.click(function () {
                playSound("/assets/audio/TOKEN_ENG/TOKEN-ENG-21.mp3");
                $('#forwardButton').prop('disabled', true);
                $('#comprehension21Button').remove();
            });

            //Audio File play function
            function playSound(soundByte) {
                var audio = document.getElementById("audio");
                $('audio').attr('src', soundByte);
                audio.play();

            }


            //Set all the Comprehension Test boards with the same parameters.
            setBoardComprehensionSingle($comprehension1, 'comprehension1', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension2, 'comprehension2', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension3, 'comprehension3', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension4, 'comprehension4', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension5, 'comprehension5', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension6, 'comprehension6', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension7, 'comprehension7', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension8, 'comprehension8', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension9, 'comprehension9', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension10, 'comprehension10', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension11, 'comprehension11', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension12, 'comprehension12', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension13, 'comprehension13', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension14, 'comprehension14', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension15, 'comprehension15', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension16, 'comprehension16', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension17, 'comprehension17', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension18, 'comprehension18', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionSingle($comprehension19, 'comprehension19', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension20, 'comprehension20', '/assets/img/comprehensionStimuli.jpg');
            setBoardComprehensionMulitple($comprehension21, 'comprehension21', '/assets/img/comprehensionStimuli.jpg');


            //Submission of test
            $('form').on('submit', function(e) {
                var userID = getUrlVars()['id'];

                $.post("http://api.girlscouts.harryatwal.com/participant/" + userID + "/comprehension", $(this).serialize())
                        .done(function (o) {
                            console.log('saved');
                        });

                callNativeApp();
                e.preventDefault();
            });

        });
    </script>
{% endblock %}